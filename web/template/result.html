<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="shortcut icon" href="/static/logo.png" type="image/x-icon"/>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap");
    </style>
    <link rel="stylesheet" href="/static/style.css"/>
    <title>Behance Project Downloader</title>
</head>
<body>
<div class="header">
    <h4><a href="/"> Behance Project Downloader </a></h4>
    <a href="/" class="another-project"> Download another Project </a>
</div>

{{ if .}}
<div class="response">
    <div class="response-header">
        <div class="author">
            <h4>
                {{.ProjectTitle}}
            </h4>
            <h4>
                by <a href="{{.Author.ProfileLink}}" target="_blank">{{.Author.Name}}</a>
            </h4>
        </div>
        <div class="buttons">
            <button type="button" class="download-selected" disabled onclick="downloadImage()">
                Download
            </button>
            <button type="button" onclick="downloadAll()" class="download-all">
                Download All
            </button>
        </div>
    </div>

    <p id="page_loading">Loading...</p>
    <div class="result">
        <form action="/download" method="POST">
            <input type="hidden" name="projectName" value="{{.ProjectTitle}}">
            <div class="results">
                {{range .Images}}

                <div class="image">
                    <input
                            type="checkbox"
                            value="{{.URL}}"
                            name="selected[]"
                            id="{{.FileName}}"
                    />
                    <label for="{{.FileName}}"></label>
                    <img src="{{.URL}}" alt="{{.FileName}}" onclick="openModal('{{.URL}}')"/>
                </div>

                {{end}}
            </div>

        </form>
    </div>
</div>

{{end}}
</body>

<script>
    let loading = document.getElementById("page_loading");
    document.addEventListener("DOMContentLoaded", function () {
        if (loading) {
            console.log("JJKSDJ");
        }
    });
    Promise.all(
        Array.from(document.images)
            .filter((img) => !img.complete)
            .map(
                (img) =>
                    new Promise((resolve) => {
                        img.onload = img.onerror = resolve;
                    })
            )
    ).then(() => {
        loading.remove();
    });
    let countSelected = 0;
    let checkBoxes = document.querySelectorAll("input[name='selected[]']");
    let download = document.querySelector(".download-selected");

    for (let index = 0; index < checkBoxes.length; index++) {
        const element = checkBoxes[index];
        element.addEventListener("change", function (e) {
            // console.log(e.target)
            if (e.target.checked) {
                countSelected++;
            } else {
                countSelected--;
            }
            if (countSelected > 0) {
                download.removeAttribute("disabled");
                download.style.display = "flex"
            } else {
                download.setAttribute("disabled", "disabled");
                // download.classList.add("d-none")
                download.style.display = "none"
            }
        });
    }

    function downloadImage() {
        if (countSelected <= 0) {
            alert("Select an image")
        } else {
            document.querySelector("form").submit();
        }
    }

    function downloadAll() {
        for (let index = 0; index < checkBoxes.length; index++) {
            checkBoxes[index].style.opacity = 0
            checkBoxes[index].checked = true;
        }
        document.querySelector("form").submit();
    }


</script>
<script>
    function openModal(url) {
        let modal = document.createElement("div")
        modal.classList.add("cm-modal")
        let image = document.createElement("img")
        let close = document.createElement("button")
        close.innerHTML = "‚ùå"
        image.src = url
        modal.append(image, close)
        close.addEventListener("click", function () {
            modal.remove()
        })
        document.body.appendChild(modal)
    }
</script>
</html>
